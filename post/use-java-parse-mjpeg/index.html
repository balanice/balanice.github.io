<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.101.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ä½¿ç”¨ Java è§£æ MJPEG ä¸º JPG æ•°ç»„ &middot; Balanice&#39;s Blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://balanice.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://balanice.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://balanice.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://balanice.github.io/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://balanice.github.io/"><h1>Balanice&#39;s Blog</h1></a>
      <p class="lead">
       èµ„æ·± Ctrl C &#43; Ctrl V ç¨‹åºå‘˜ 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://balanice.github.io/">Home</a> </li>
        <li><a href="https://github.com/balanice/"> balanice </a></li>
      </ul>
    </nav>

    <p>tokuu@outlook.com</p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>ä½¿ç”¨ Java è§£æ MJPEG ä¸º JPG æ•°ç»„</h1>
  <time datetime=2021-01-19T08:12:37&#43;0800 class="post-date">Tue, Jan 19, 2021</time>
  <h2 id="mjpeg-æ˜¯ä»€ä¹ˆ">MJPEG æ˜¯ä»€ä¹ˆ</h2>
<p>Motion JPEG (M-JPEG æˆ– MJPEG, Motion Joint Photographic Experts Group, FourCC:MJPG) æ˜¯ä¸€ç§å½±åƒå‹ç¼©æ ¼å¼ï¼Œå…¶ä¸­æ¯ä¸€å¸§å›¾åƒéƒ½åˆ†åˆ«ä½¿ç”¨ JPEG ç¼–ç . MJPEG å¸¸ç”¨åœ¨æ•°ç ç›¸æœºå’Œæ‘„åƒå¤´ä¹‹ç±»çš„å›¾åƒé‡‡é›†è®¾å¤‡ä¸Š, éçº¿æ€§å‰ªè¾‘ç³»ç»Ÿä¹Ÿå¸¸é‡‡ç”¨è¿™ç§æ ¼å¼, å¯ç²¾ç¡®åˆ°å¸§ç¼–è¾‘å’Œå¤šå±‚å›¾åƒå¤„ç†ï¼ŒæŠŠè¿åŠ¨çš„è§†é¢‘åºåˆ—ä½œä¸ºè¿ç»­çš„é™æ­¢å›¾åƒæ¥å¤„ç†ï¼Œè¿™ç§å‹ç¼©æ–¹å¼å•ç‹¬å®Œæ•´åœ°å‹ç¼©æ¯ä¸€å¸§ï¼Œåœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­å¯éšæœºå­˜å‚¨æ¯ä¸€å¸§ï¼Œå¯è¿›è¡Œç²¾ç¡®åˆ°å¸§çš„ç¼–è¾‘.</p>
<p>QuickTime æ’­æ”¾å™¨å’ŒåŒ…æ‹¬ Mozilia Firefox, Google Chrome, Safari åœ¨å†…è®¸å¤šç½‘é¡µæµè§ˆå™¨åŸç”Ÿæ”¯æŒ M-JPEG.</p>
<p>å¦‚æœåªæ˜¯æƒ³åœ¨å‰ç«¯å±•ç¤º, ç›´æ¥ç”¨ img æ ‡ç­¾å³å¯, ä¾‹å¦‚ä½ æœ‰ä¸€ä¸ªåœ°å€ä¸º <code>http://localhost:8964/apple.mjpeg</code> çš„è§†é¢‘æµ:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://localhost:8964/apple.mjpeg&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1080&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1920&#34;</span>&gt;
</span></span></code></pre></div><h2 id="å¦‚ä½•è§£æ">å¦‚ä½•è§£æ</h2>
<p>é€šè¿‡ä¸Šé¢ä»‹ç»æˆ‘ä»¬çŸ¥é“äº† MJPEG æ˜¯ç”±å®Œæ•´çš„ JPEG å›¾ç‰‡ç»„æˆçš„è§†é¢‘æµ, é‚£ä¹ˆæƒ³è§£æ MJPEG å°±è¦å…ˆäº†è§£ä¸€ä¸‹ jpg æ ¼å¼. æ‰¾ä¸€å¼  jpg å›¾ç‰‡, ä½¿ç”¨ <code>Bless Hex Editor</code> æˆ–è€… <code>UltraEdit</code> æ‰“å¼€</p>
<p><img src="/images/2021-01-19-jpg-hex-start.png" alt="hex-start"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ° jpg å›¾ç‰‡çš„å¼€å¤´æ˜¯ <code>FF D8</code></p>
<p><img src="/images/2021-01-19-jpg-hex-end.png" alt="hex-end"></p>
<p>ä¸‹æ‹‰åˆ°ç»“å°¾, å¯ä»¥çœ‹åˆ° jpg å›¾ç‰‡ä»¥ <code>FF D9</code> ç»“å°¾.</p>
<h3 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h3>
<p>é€šè¿‡ä¸‡èƒ½çš„ Google æ‰¾åˆ°äº† <a href="https://github.com/andrealaforgia/mjpeg-client/blob/master/src/main/java/com/andrealaforgia/mjpegclient/MjpegRunner.java">github ä¸Šçš„å®ç°</a>, å…·ä½“ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String CONTENT_LENGTH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Content-Length: &#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String CONTENT_TYPE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Content-type: image/jpeg&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> InputStream urlStream<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* Using the urlStream get the next JPEG image as a byte[]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* @return byte[] of the JPEG
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">retrieveNextImage</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> currByte <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String header <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// build headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// the DCS-930L stops it&#39;s headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">boolean</span> captureContentLength <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    StringWriter contentLengthStringWriter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringWriter<span style="color:#f92672">(</span>128<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    StringWriter headerWriter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringWriter<span style="color:#f92672">(</span>128<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> contentLength <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">((</span>currByte <span style="color:#f92672">=</span> urlStream<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">())</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>captureContentLength<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>currByte <span style="color:#f92672">==</span> 10 <span style="color:#f92672">||</span> currByte <span style="color:#f92672">==</span> 13<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                contentLength <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">parseInt</span><span style="color:#f92672">(</span>contentLengthStringWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            contentLengthStringWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>currByte<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            headerWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>currByte<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            String tempString <span style="color:#f92672">=</span> headerWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> indexOf <span style="color:#f92672">=</span> tempString<span style="color:#f92672">.</span><span style="color:#a6e22e">indexOf</span><span style="color:#f92672">(</span>CONTENT_LENGTH<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>indexOf <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                captureContentLength <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 255 indicates the start of the jpeg image
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">((</span>urlStream<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">())</span> <span style="color:#f92672">!=</span> 255<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// just skip extras
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// rest is the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> imageBytes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>contentLength <span style="color:#f92672">+</span> 1<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// since we ate the original 255 , shove it back in
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    imageBytes<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> 255<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> offset <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> numRead <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>offset <span style="color:#f92672">&lt;</span> imageBytes<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>numRead <span style="color:#f92672">=</span> urlStream<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>imageBytes<span style="color:#f92672">,</span> offset<span style="color:#f92672">,</span> imageBytes<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> offset<span style="color:#f92672">))</span> <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        offset <span style="color:#f92672">+=</span> numRead<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> imageBytes<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ä¸Šè¿°ä»£ç æ˜¯é€šè¿‡å…ˆè§£æ MJPEG æ•°æ®æµçš„å¤´éƒ¨, è·å–åˆ°ä¸€å¼ å›¾ç‰‡çš„ <code>Content-Length</code>, ç„¶åå¼€å§‹æŸ¥æ‰¾ jpg å›¾ç‰‡çš„å¼€å¤´, æ¥ä¸‹æ¥æŒç»­è¯»å–ç›´åˆ°å›¾ç‰‡é•¿åº¦, å°±å¯ä»¥è·å–åˆ°å®Œæ•´çš„ä¸€å¼  jpg å›¾ç‰‡çš„ byte æ•°ç»„.</p>
<p>é€šè¿‡ <code>Ctrl C+V</code> ç°åœ¨å¯ä»¥è§£æ MJPEG ä¸ºå•å¼ å›¾ç‰‡çš„ byte[] äº†, ä½†æ˜¯æµ‹è¯•åå‘ç°è§£æä¸€å¼ å›¾ç‰‡å±…ç„¶è¦ 100ms å·¦å³, è¿™æ€ä¹ˆè¡Œ, è¿ 30 å¸§éƒ½è¾¾ä¸åˆ°, å…«æˆæ˜¯è¿™ä¸ªè¿ star éƒ½æ²¡æœ‰çš„é¡¹ç›®ä»£ç å†™å¾—ä¸è¡Œ, æˆ‘å¾—ç»™å®ƒä¼˜åŒ–ä¸€ä¸‹, äºæ˜¯å°±æœ‰äº†æ–¹æ³•äºŒ</p>
<h3 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h3>
<p>ä»ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“ jpg å›¾ç‰‡ä»¥ <code>FF D8</code> å¼€å¤´, <code>FF D9</code> ç»“å°¾, æˆ‘çš„åˆæ­¥æ€è·¯å°±æ˜¯å®šä¹‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ byte[], å°†æ•°æ®è¯»å–åˆ° byte[] ä¸­, ç„¶åéå†ä¸€éæŸ¥æ‰¾ jpg å›¾ç‰‡çš„å¼€å¤´å’Œç»“å°¾, ç„¶åå–å‡ºå¼€å¤´å’Œç»“å°¾é—´çš„æ•°æ®å°±æ˜¯ä¸€å¸§å®Œæ•´çš„å›¾ç‰‡, ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">retrieve</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span> ff <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span>0xFF<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span> s2 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span>0xD8<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span> e2 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span>0xD9<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> startIndex <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> endIndex <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1MB çš„ç¼“å­˜, æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> length <span style="color:#f92672">=</span> 1024 <span style="color:#f92672">*</span> 1024<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> cache <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>length<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> offset <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> read<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">((</span>read <span style="color:#f92672">=</span> inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>cache<span style="color:#f92672">,</span> offset<span style="color:#f92672">,</span> length <span style="color:#f92672">-</span> offset<span style="color:#f92672">))</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> offset<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> offset <span style="color:#f92672">+</span> read <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>startIndex <span style="color:#f92672">==</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cache<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> ff <span style="color:#f92672">&amp;&amp;</span> cache<span style="color:#f92672">[</span>i <span style="color:#f92672">+</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> s2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        startIndex <span style="color:#f92672">=</span> i<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                        logger<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;startIndex: {}&#34;</span><span style="color:#f92672">,</span> startIndex<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cache<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> ff <span style="color:#f92672">&amp;&amp;</span> cache<span style="color:#f92672">[</span>i <span style="color:#f92672">+</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> e2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    endIndex <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> 2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    logger<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endIndex: {}&#34;</span><span style="color:#f92672">,</span> endIndex<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            offset <span style="color:#f92672">+=</span> read<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>startIndex <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1 <span style="color:#f92672">&amp;&amp;</span> endIndex <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOfRange</span><span style="color:#f92672">(</span>cache<span style="color:#f92672">,</span> startIndex<span style="color:#f92672">,</span> endIndex<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨ä¸Šè¿°ä»£ç æµ‹è¯•, å‘ç°å›¾ç‰‡çš„å¼€å§‹ä½ç½®æ˜¯å›ºå®šçš„ 68, å°†å‰é¢ 68 ä¸ª byte è½¬æ¢æˆ String è¾“å‡º:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>--<span style="color:#ae81ff">boundryString</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Content-type</span>: <span style="color:#ae81ff">image/jpeg</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Content-Length</span>: <span style="color:#ae81ff">67832</span>
</span></span></code></pre></div><p>åŸæ¥æ¯ä¸€å¸§å›¾åƒæ•°æ®éƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªå¤´æ–‡ä»¶, é€šè¿‡è¿™ä¸ªå¤´æ–‡ä»¶æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°å›¾ç‰‡çš„æ ¼å¼å’Œå¤§å°, é‚£ä¹ˆåªè¦è§£æè¿™ä¸ªå¤´æ–‡ä»¶, æ‹¿åˆ°å›¾ç‰‡çš„å¤§å°, å†å®šä½åˆ° jpg çš„å¼€å¤´, å°±èƒ½å¾—åˆ°å®Œæ•´çš„å›¾åƒ.</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ç»è¿‡æµ‹è¯•, æ–°çš„æ–¹æ³•è§£æé€Ÿåº¦è¿˜æ˜¯ 100ms, æ—¶é—´å¤§éƒ¨åˆ†æ¶ˆè€—åœ¨ <code>read = inputStream.read(cache, offset, length - offset)</code> è¿™é‡Œäº†ğŸ˜“</p>

</div>


    </main>

    
      
    
  </body>
</html>
